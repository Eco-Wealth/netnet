# x402 paywall

## Endpoints

- `GET /api/health` → always `200`.
- `GET /api/proof-paid` → paywalled.
  - Returns `402` + challenge headers when unpaid.
  - Returns `200` JSON when paid/authorized.
  - Returns `503` when `X402_PAY_TO` is missing and bypass is not enabled.

## Dev bypass (explicit)

In local development only, you can bypass the paywall:

- Set `X402_DEV_BYPASS=true`
- Restart dev server

When bypass is enabled, `GET /api/proof-paid` returns:

```json
{ "ok": true, "paid": true, "bypass": true, "mode": "dev_bypass", "payTo": "..." }
```

## Local paid simulation (optional)

You can simulate a paid request without turning bypass on:

- Set `X402_DEV_PAID_TOKEN=<local-secret>`
- Send request header: `x-netnet-paid-token: <local-secret>`

Expected response:
- `200` with `{ ok:true, paid:true, mode:"dev_token" }`

## Required env

- `X402_PAY_TO` (recipient identifier used in the x402 challenge; typically an address)
- `X402_DEV_BYPASS` (optional; must be exactly `true` to bypass)
- `X402_DEV_PAID_TOKEN` (optional; local paid simulation token)

## Curl acceptance

```bash
curl -i http://localhost:3000/api/health
curl -i http://localhost:3000/api/proof-paid
```

With local paid token:

```bash
X402_DEV_PAID_TOKEN=netnet-local-paid npm run dev
curl -i -H "x-netnet-paid-token: netnet-local-paid" http://localhost:3000/api/proof-paid
```
